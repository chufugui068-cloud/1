# 微信小程序实施方案（基于你的确认信息）

## 1. 需求确认（来自你本轮答复）
- 上线目标：公开上线给用户使用。
- 功能范围：你希望全功能都做（数据源、ELO、蒙特卡洛、BT、比分、理由、历史进化、今日竞彩、VIP）。
- 风格偏好：稳健预测。
- 技术方向：微信云开发。
- 数据方式：500彩票网网页实时抓取（并保留替代数据方案）。
- 商业化：月卡 VIP。
- 当前支付条件：暂无商户号。

## 2. 推荐总体架构（微信云开发）

### 2.1 架构分层
1. **小程序前端（原生）**
   - 首页：今日竞彩足球比赛
   - 详情页：胜平负、让球、总进球、TOP3 比分、推荐理由
   - 历史页：预测记录、命中率、模型表现
   - VIP页：会员权益、月卡开通、权益状态

2. **云函数层（Node.js）**
   - 比赛抓取与清洗
   - 调用模型服务并聚合结果
   - 权限鉴权（普通用户/VIP）
   - 历史记录写入与统计

3. **模型服务层（Python）**
   - ELO 实力评分
   - Bradley-Terry 概率计算
   - Monte Carlo 5000 次模拟
   - 权重融合 + 稳健策略约束（降噪）

4. **数据层（云数据库）**
   - 比赛、球队、赔率快照
   - 预测结果、命中结果、模型参数
   - 用户、会员、充值订单

### 2.2 定时任务
- 每日清晨：拉取“今日竞彩”与历史赛果更新。
- 开赛前（如每30分钟）：刷新赔率与模型重算。
- 赛后：回写真实结果、更新命中率、触发参数优化。

## 3. 关键功能落地方式

### 3.1 数据源选择（500/球探）
- V1 默认：500网页抓取。
- V1.1 增加：球探网作为降级源。
- 策略：当主源异常时自动切换并标注“数据延迟状态”。

### 3.2 ELO评分系统
- 输入：历史赛果、主客场、赛事级别、时间衰减。
- 输出：`elo_home`, `elo_away`, `elo_diff`。
- 更新：每场赛后增量更新；联赛间使用初始锚点归一化。

### 3.3 Monte Carlo（5000次）
- 依据：期望进球（λ_home, λ_away）+ 强弱差 + 盘口/赔率校正。
- 输出：
  - 胜平负概率
  - 让球胜平负概率
  - 总进球区间概率
  - 比分分布（用于TOP3）

### 3.4 Bradley-Terry 模型
- 根据球队强弱参数计算对抗胜率。
- 与ELO、模拟结果做融合，形成稳健概率。

### 3.5 TOP3 波胆预测
- 从比分概率分布中选取最高3项。
- 展示格式：`1-0 (18.2%)`, `1-1 (15.6%)`, `2-1 (12.9%)`。

### 3.6 推荐理由生成
- 基于规则模板 + 数据特征填充：
  - 近期状态
  - ELO差值
  - 主客场表现
  - 赔率变化趋势
- 输出限制：不出现“保证盈利”等违规表述。

### 3.7 历史记录与自我进化
- 自动记录每场预测快照。
- 赛后计算命中（胜平负/比分/总进球）。
- 自动调参：按最近 N 场表现更新模型权重。
- 同时保留手动参数开关（运营后台）。

### 3.8 今日竞彩
- 按竞彩可投注场次展示。
- 支持按联赛、时间筛选。
- 支持“一键刷新最新赔率与预测时间戳”。

### 3.9 VIP（月卡）
- 免费用户：每日查看场次和基础概率。
- VIP 用户：高级指标、TOP3比分、完整推荐理由、历史复盘。
- 当前你暂无商户号：先上“权益逻辑”，支付接口后接。

## 4. 合规与风险控制（必须）
- 明确产品定位为“数据分析与参考建议”，非代客投注。
- 页面增加风险提示和免责声明。
- 避免“稳赚”“包中”等诱导文案。
- 对抓取频率做限流与缓存，避免目标站点压力与封禁。

## 5. 开发计划（建议）

### Sprint 1（MVP，7天）
- 今日竞彩列表
- 单场预测（ELO+BT+MC融合）
- TOP3比分
- 推荐理由
- 历史记录写入

### Sprint 2（可运营，7天）
- 模型参数后台
- 命中率统计看板
- 多数据源切换
- 异常告警

### Sprint 3（商业化，7天）
- VIP权益开关
- 月卡订单体系（待支付接入）
- 用户增长活动（邀请码/试用）

## 6. 你当前最该先做的3件事
1. 注册并配置微信云开发环境（测试环境 + 正式环境）。
2. 确认数据抓取字段清单（联赛、比赛ID、赔率、开赛时间、赛果）。
3. 先落地 MVP 页面与接口联调，不等支付功能。

## 7. 我们下一轮可直接进入
- 前端页面原型（页面结构 + 文案 + 组件清单）。
- 云函数目录与代码骨架。
- Python模型服务最小可运行版（含5000次模拟）。
